{"ast":null,"code":"'use strict'; // Load modules\n\nconst Hoek = require('hoek');\n\nconst Any = require('./types/any');\n\nconst Cast = require('./cast');\n\nconst Errors = require('./errors');\n\nconst Lazy = require('./types/lazy');\n\nconst Ref = require('./ref');\n\nconst Settings = require('./types/any/settings'); // Declare internals\n\n\nconst internals = {\n  alternatives: require('./types/alternatives'),\n  array: require('./types/array'),\n  boolean: require('./types/boolean'),\n  binary: require('./types/binary'),\n  date: require('./types/date'),\n  func: require('./types/func'),\n  number: require('./types/number'),\n  object: require('./types/object'),\n  string: require('./types/string'),\n  symbol: require('./types/symbol')\n};\n\ninternals.callWithDefaults = function (schema, args) {\n  Hoek.assert(this, 'Must be invoked on a Joi instance.');\n\n  if (this._defaults) {\n    schema = this._defaults(schema);\n  }\n\n  schema._currentJoi = this;\n  return schema._init(...args);\n};\n\ninternals.root = function () {\n  const any = new Any();\n  const root = any.clone();\n  Any.prototype._currentJoi = root;\n  root._currentJoi = root;\n  root._binds = new Set(['any', 'alternatives', 'alt', 'array', 'boolean', 'binary', 'date', 'func', 'number', 'object', 'string', 'symbol', 'validate', 'describe', 'compile', 'assert', 'attempt', 'lazy', 'defaults', 'extend', 'allow', 'valid', 'only', 'equal', 'invalid', 'disallow', 'not', 'required', 'exist', 'optional', 'forbidden', 'strip', 'when', 'empty', 'default']);\n\n  root.any = function (...args) {\n    Hoek.assert(args.length === 0, 'Joi.any() does not allow arguments.');\n    return internals.callWithDefaults.call(this, any, args);\n  };\n\n  root.alternatives = root.alt = function (...args) {\n    return internals.callWithDefaults.call(this, internals.alternatives, args);\n  };\n\n  root.array = function (...args) {\n    Hoek.assert(args.length === 0, 'Joi.array() does not allow arguments.');\n    return internals.callWithDefaults.call(this, internals.array, args);\n  };\n\n  root.boolean = root.bool = function (...args) {\n    Hoek.assert(args.length === 0, 'Joi.boolean() does not allow arguments.');\n    return internals.callWithDefaults.call(this, internals.boolean, args);\n  };\n\n  root.binary = function (...args) {\n    Hoek.assert(args.length === 0, 'Joi.binary() does not allow arguments.');\n    return internals.callWithDefaults.call(this, internals.binary, args);\n  };\n\n  root.date = function (...args) {\n    Hoek.assert(args.length === 0, 'Joi.date() does not allow arguments.');\n    return internals.callWithDefaults.call(this, internals.date, args);\n  };\n\n  root.func = function (...args) {\n    Hoek.assert(args.length === 0, 'Joi.func() does not allow arguments.');\n    return internals.callWithDefaults.call(this, internals.func, args);\n  };\n\n  root.number = function (...args) {\n    Hoek.assert(args.length === 0, 'Joi.number() does not allow arguments.');\n    return internals.callWithDefaults.call(this, internals.number, args);\n  };\n\n  root.object = function (...args) {\n    return internals.callWithDefaults.call(this, internals.object, args);\n  };\n\n  root.string = function (...args) {\n    Hoek.assert(args.length === 0, 'Joi.string() does not allow arguments.');\n    return internals.callWithDefaults.call(this, internals.string, args);\n  };\n\n  root.symbol = function (...args) {\n    Hoek.assert(args.length === 0, 'Joi.symbol() does not allow arguments.');\n    return internals.callWithDefaults.call(this, internals.symbol, args);\n  };\n\n  root.ref = function (...args) {\n    return Ref.create(...args);\n  };\n\n  root.isRef = function (ref) {\n    return Ref.isRef(ref);\n  };\n\n  root.validate = function (value, ...args\n  /*, [schema], [options], callback */\n  ) {\n    const last = args[args.length - 1];\n    const callback = typeof last === 'function' ? last : null;\n    const count = args.length - (callback ? 1 : 0);\n\n    if (count === 0) {\n      return any.validate(value, callback);\n    }\n\n    const options = count === 2 ? args[1] : undefined;\n    const schema = this.compile(args[0]);\n    return schema._validateWithOptions(value, options, callback);\n  };\n\n  root.describe = function (...args) {\n    const schema = args.length ? this.compile(args[0]) : any;\n    return schema.describe();\n  };\n\n  root.compile = function (schema) {\n    try {\n      return Cast.schema(this, schema);\n    } catch (err) {\n      if (err.hasOwnProperty('path')) {\n        err.message = err.message + '(' + err.path + ')';\n      }\n\n      throw err;\n    }\n  };\n\n  root.assert = function (value, schema, message) {\n    this.attempt(value, schema, message);\n  };\n\n  root.attempt = function (value, schema, message) {\n    const result = this.validate(value, schema);\n    const error = result.error;\n\n    if (error) {\n      if (!message) {\n        if (typeof error.annotate === 'function') {\n          error.message = error.annotate();\n        }\n\n        throw error;\n      }\n\n      if (!(message instanceof Error)) {\n        if (typeof error.annotate === 'function') {\n          error.message = `${message} ${error.annotate()}`;\n        }\n\n        throw error;\n      }\n\n      throw message;\n    }\n\n    return result.value;\n  };\n\n  root.reach = function (schema, path) {\n    Hoek.assert(schema && schema instanceof Any, 'you must provide a joi schema');\n    Hoek.assert(Array.isArray(path) || typeof path === 'string', 'path must be a string or an array of strings');\n\n    const reach = (sourceSchema, schemaPath) => {\n      if (!schemaPath.length) {\n        return sourceSchema;\n      }\n\n      const children = sourceSchema._inner.children;\n\n      if (!children) {\n        return;\n      }\n\n      const key = schemaPath.shift();\n\n      for (let i = 0; i < children.length; ++i) {\n        const child = children[i];\n\n        if (child.key === key) {\n          return reach(child.schema, schemaPath);\n        }\n      }\n    };\n\n    const schemaPath = typeof path === 'string' ? path ? path.split('.') : [] : path.slice();\n    return reach(schema, schemaPath);\n  };\n\n  root.lazy = function (...args) {\n    return internals.callWithDefaults.call(this, Lazy, args);\n  };\n\n  root.defaults = function (fn) {\n    Hoek.assert(typeof fn === 'function', 'Defaults must be a function');\n    let joi = Object.create(this.any());\n    joi = fn(joi);\n    Hoek.assert(joi && joi instanceof this.constructor, 'defaults() must return a schema');\n    Object.assign(joi, this, joi.clone()); // Re-add the types from `this` but also keep the settings from joi's potential new defaults\n\n    joi._defaults = schema => {\n      if (this._defaults) {\n        schema = this._defaults(schema);\n        Hoek.assert(schema instanceof this.constructor, 'defaults() must return a schema');\n      }\n\n      schema = fn(schema);\n      Hoek.assert(schema instanceof this.constructor, 'defaults() must return a schema');\n      return schema;\n    };\n\n    return joi;\n  };\n\n  root.bind = function () {\n    const joi = Object.create(this);\n\n    joi._binds.forEach(bind => {\n      joi[bind] = joi[bind].bind(joi);\n    });\n\n    return joi;\n  };\n\n  root.extend = function (...args) {\n    const extensions = Hoek.flatten(args);\n    Hoek.assert(extensions.length > 0, 'You need to provide at least one extension');\n    this.assert(extensions, root.extensionsSchema);\n    const joi = Object.create(this.any());\n    Object.assign(joi, this);\n    joi._currentJoi = joi;\n    joi._binds = new Set(joi._binds);\n\n    for (let i = 0; i < extensions.length; ++i) {\n      let extension = extensions[i];\n\n      if (typeof extension === 'function') {\n        extension = extension(joi);\n      }\n\n      this.assert(extension, root.extensionSchema);\n      const base = (extension.base || this.any()).clone(); // Cloning because we're going to override language afterwards\n\n      const ctor = base.constructor;\n      const type = class extends ctor {\n        // eslint-disable-line no-loop-func\n        constructor() {\n          super();\n\n          if (extension.base) {\n            Object.assign(this, base);\n          }\n\n          this._type = extension.name;\n\n          if (extension.language) {\n            this._settings = Settings.concat(this._settings, {\n              language: {\n                [extension.name]: extension.language\n              }\n            });\n          }\n        }\n\n      };\n\n      if (extension.coerce) {\n        type.prototype._coerce = function (value, state, options) {\n          if (ctor.prototype._coerce) {\n            const baseRet = ctor.prototype._coerce.call(this, value, state, options);\n\n            if (baseRet.errors) {\n              return baseRet;\n            }\n\n            value = baseRet.value;\n          }\n\n          const ret = extension.coerce.call(this, value, state, options);\n\n          if (ret instanceof Errors.Err) {\n            return {\n              value,\n              errors: ret\n            };\n          }\n\n          return {\n            value: ret\n          };\n        };\n      }\n\n      if (extension.pre) {\n        type.prototype._base = function (value, state, options) {\n          if (ctor.prototype._base) {\n            const baseRet = ctor.prototype._base.call(this, value, state, options);\n\n            if (baseRet.errors) {\n              return baseRet;\n            }\n\n            value = baseRet.value;\n          }\n\n          const ret = extension.pre.call(this, value, state, options);\n\n          if (ret instanceof Errors.Err) {\n            return {\n              value,\n              errors: ret\n            };\n          }\n\n          return {\n            value: ret\n          };\n        };\n      }\n\n      if (extension.rules) {\n        for (let j = 0; j < extension.rules.length; ++j) {\n          const rule = extension.rules[j];\n          const ruleArgs = rule.params ? rule.params instanceof Any ? rule.params._inner.children.map(k => k.key) : Object.keys(rule.params) : [];\n          const validateArgs = rule.params ? Cast.schema(this, rule.params) : null;\n\n          type.prototype[rule.name] = function (...rArgs) {\n            // eslint-disable-line no-loop-func\n            if (rArgs.length > ruleArgs.length) {\n              throw new Error('Unexpected number of arguments');\n            }\n\n            let hasRef = false;\n            let arg = {};\n\n            for (let k = 0; k < ruleArgs.length; ++k) {\n              arg[ruleArgs[k]] = rArgs[k];\n\n              if (!hasRef && Ref.isRef(rArgs[k])) {\n                hasRef = true;\n              }\n            }\n\n            if (validateArgs) {\n              arg = joi.attempt(arg, validateArgs);\n            }\n\n            let schema;\n\n            if (rule.validate) {\n              const validate = function (value, state, options) {\n                return rule.validate.call(this, arg, value, state, options);\n              };\n\n              schema = this._test(rule.name, arg, validate, {\n                description: rule.description,\n                hasRef\n              });\n            } else {\n              schema = this.clone();\n            }\n\n            if (rule.setup) {\n              const newSchema = rule.setup.call(schema, arg);\n\n              if (newSchema !== undefined) {\n                Hoek.assert(newSchema instanceof Any, `Setup of extension Joi.${this._type}().${rule.name}() must return undefined or a Joi object`);\n                schema = newSchema;\n              }\n            }\n\n            return schema;\n          };\n        }\n      }\n\n      if (extension.describe) {\n        type.prototype.describe = function () {\n          const description = ctor.prototype.describe.call(this);\n          return extension.describe.call(this, description);\n        };\n      }\n\n      const instance = new type();\n\n      joi[extension.name] = function (...extArgs) {\n        return internals.callWithDefaults.call(this, instance, extArgs);\n      };\n\n      joi._binds.add(extension.name);\n    }\n\n    return joi;\n  };\n\n  root.extensionSchema = internals.object.keys({\n    base: internals.object.type(Any, 'Joi object'),\n    name: internals.string.required(),\n    coerce: internals.func.arity(3),\n    pre: internals.func.arity(3),\n    language: internals.object,\n    describe: internals.func.arity(1),\n    rules: internals.array.items(internals.object.keys({\n      name: internals.string.required(),\n      setup: internals.func.arity(1),\n      validate: internals.func.arity(4),\n      params: [internals.object.pattern(/.*/, internals.object.type(Any, 'Joi object')), internals.object.type(internals.object.constructor, 'Joi object')],\n      description: [internals.string, internals.func.arity(1)]\n    }).or('setup', 'validate'))\n  }).strict();\n  root.extensionsSchema = internals.array.items([internals.object, internals.func.arity(1)]).strict();\n  root.version = require('../package.json').version;\n  return root;\n};\n\nmodule.exports = internals.root();","map":{"version":3,"sources":["C:/Users/usuario/desktop/chained/chained/node_modules/joi/lib/index.js"],"names":["Hoek","require","Any","Cast","Errors","Lazy","Ref","Settings","internals","alternatives","array","boolean","binary","date","func","number","object","string","symbol","callWithDefaults","schema","args","assert","_defaults","_currentJoi","_init","root","any","clone","prototype","_binds","Set","length","call","alt","bool","ref","create","isRef","validate","value","last","callback","count","options","undefined","compile","_validateWithOptions","describe","err","hasOwnProperty","message","path","attempt","result","error","annotate","Error","reach","Array","isArray","sourceSchema","schemaPath","children","_inner","key","shift","i","child","split","slice","lazy","defaults","fn","joi","Object","constructor","assign","bind","forEach","extend","extensions","flatten","extensionsSchema","extension","extensionSchema","base","ctor","type","_type","name","language","_settings","concat","coerce","_coerce","state","baseRet","errors","ret","Err","pre","_base","rules","j","rule","ruleArgs","params","map","k","keys","validateArgs","rArgs","hasRef","arg","_test","description","setup","newSchema","instance","extArgs","add","required","arity","items","pattern","or","strict","version","module","exports"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\n// Load modules\r\n\r\nconst Hoek = require('hoek');\r\nconst Any = require('./types/any');\r\nconst Cast = require('./cast');\r\nconst Errors = require('./errors');\r\nconst Lazy = require('./types/lazy');\r\nconst Ref = require('./ref');\r\nconst Settings = require('./types/any/settings');\r\n\r\n\r\n// Declare internals\r\n\r\nconst internals = {\r\n    alternatives: require('./types/alternatives'),\r\n    array: require('./types/array'),\r\n    boolean: require('./types/boolean'),\r\n    binary: require('./types/binary'),\r\n    date: require('./types/date'),\r\n    func: require('./types/func'),\r\n    number: require('./types/number'),\r\n    object: require('./types/object'),\r\n    string: require('./types/string'),\r\n    symbol: require('./types/symbol')\r\n};\r\n\r\ninternals.callWithDefaults = function (schema, args) {\r\n\r\n    Hoek.assert(this, 'Must be invoked on a Joi instance.');\r\n\r\n    if (this._defaults) {\r\n        schema = this._defaults(schema);\r\n    }\r\n\r\n    schema._currentJoi = this;\r\n\r\n    return schema._init(...args);\r\n};\r\n\r\ninternals.root = function () {\r\n\r\n    const any = new Any();\r\n\r\n    const root = any.clone();\r\n    Any.prototype._currentJoi = root;\r\n    root._currentJoi = root;\r\n    root._binds = new Set(['any', 'alternatives', 'alt', 'array', 'boolean', 'binary', 'date', 'func', 'number', 'object', 'string', 'symbol', 'validate', 'describe', 'compile', 'assert', 'attempt', 'lazy', 'defaults', 'extend', 'allow', 'valid', 'only', 'equal', 'invalid', 'disallow', 'not', 'required', 'exist', 'optional', 'forbidden', 'strip', 'when', 'empty', 'default']);\r\n\r\n    root.any = function (...args) {\r\n\r\n        Hoek.assert(args.length === 0, 'Joi.any() does not allow arguments.');\r\n\r\n        return internals.callWithDefaults.call(this, any, args);\r\n    };\r\n\r\n    root.alternatives = root.alt = function (...args) {\r\n\r\n        return internals.callWithDefaults.call(this, internals.alternatives, args);\r\n    };\r\n\r\n    root.array = function (...args) {\r\n\r\n        Hoek.assert(args.length === 0, 'Joi.array() does not allow arguments.');\r\n\r\n        return internals.callWithDefaults.call(this, internals.array, args);\r\n    };\r\n\r\n    root.boolean = root.bool = function (...args) {\r\n\r\n        Hoek.assert(args.length === 0, 'Joi.boolean() does not allow arguments.');\r\n\r\n        return internals.callWithDefaults.call(this, internals.boolean, args);\r\n    };\r\n\r\n    root.binary = function (...args) {\r\n\r\n        Hoek.assert(args.length === 0, 'Joi.binary() does not allow arguments.');\r\n\r\n        return internals.callWithDefaults.call(this, internals.binary, args);\r\n    };\r\n\r\n    root.date = function (...args) {\r\n\r\n        Hoek.assert(args.length === 0, 'Joi.date() does not allow arguments.');\r\n\r\n        return internals.callWithDefaults.call(this, internals.date, args);\r\n    };\r\n\r\n    root.func = function (...args) {\r\n\r\n        Hoek.assert(args.length === 0, 'Joi.func() does not allow arguments.');\r\n\r\n        return internals.callWithDefaults.call(this, internals.func, args);\r\n    };\r\n\r\n    root.number = function (...args) {\r\n\r\n        Hoek.assert(args.length === 0, 'Joi.number() does not allow arguments.');\r\n\r\n        return internals.callWithDefaults.call(this, internals.number, args);\r\n    };\r\n\r\n    root.object = function (...args) {\r\n\r\n        return internals.callWithDefaults.call(this, internals.object, args);\r\n    };\r\n\r\n    root.string = function (...args) {\r\n\r\n        Hoek.assert(args.length === 0, 'Joi.string() does not allow arguments.');\r\n\r\n        return internals.callWithDefaults.call(this, internals.string, args);\r\n    };\r\n\r\n    root.symbol = function (...args) {\r\n\r\n        Hoek.assert(args.length === 0, 'Joi.symbol() does not allow arguments.');\r\n\r\n        return internals.callWithDefaults.call(this, internals.symbol, args);\r\n    };\r\n\r\n    root.ref = function (...args) {\r\n\r\n        return Ref.create(...args);\r\n    };\r\n\r\n    root.isRef = function (ref) {\r\n\r\n        return Ref.isRef(ref);\r\n    };\r\n\r\n    root.validate = function (value, ...args /*, [schema], [options], callback */) {\r\n\r\n        const last = args[args.length - 1];\r\n        const callback = typeof last === 'function' ? last : null;\r\n\r\n        const count = args.length - (callback ? 1 : 0);\r\n        if (count === 0) {\r\n            return any.validate(value, callback);\r\n        }\r\n\r\n        const options = count === 2 ? args[1] : undefined;\r\n        const schema = this.compile(args[0]);\r\n\r\n        return schema._validateWithOptions(value, options, callback);\r\n    };\r\n\r\n    root.describe = function (...args) {\r\n\r\n        const schema = args.length ? this.compile(args[0]) : any;\r\n        return schema.describe();\r\n    };\r\n\r\n    root.compile = function (schema) {\r\n\r\n        try {\r\n            return Cast.schema(this, schema);\r\n        }\r\n        catch (err) {\r\n            if (err.hasOwnProperty('path')) {\r\n                err.message = err.message + '(' + err.path + ')';\r\n            }\r\n\r\n            throw err;\r\n        }\r\n    };\r\n\r\n    root.assert = function (value, schema, message) {\r\n\r\n        this.attempt(value, schema, message);\r\n    };\r\n\r\n    root.attempt = function (value, schema, message) {\r\n\r\n        const result = this.validate(value, schema);\r\n        const error = result.error;\r\n        if (error) {\r\n            if (!message) {\r\n                if (typeof error.annotate === 'function') {\r\n                    error.message = error.annotate();\r\n                }\r\n\r\n                throw error;\r\n            }\r\n\r\n            if (!(message instanceof Error)) {\r\n                if (typeof error.annotate === 'function') {\r\n                    error.message = `${message} ${error.annotate()}`;\r\n                }\r\n\r\n                throw error;\r\n            }\r\n\r\n            throw message;\r\n        }\r\n\r\n        return result.value;\r\n    };\r\n\r\n    root.reach = function (schema, path) {\r\n\r\n        Hoek.assert(schema && schema instanceof Any, 'you must provide a joi schema');\r\n        Hoek.assert(Array.isArray(path) || typeof path === 'string', 'path must be a string or an array of strings');\r\n\r\n        const reach = (sourceSchema, schemaPath) => {\r\n\r\n            if (!schemaPath.length) {\r\n                return sourceSchema;\r\n            }\r\n\r\n            const children = sourceSchema._inner.children;\r\n            if (!children) {\r\n                return;\r\n            }\r\n\r\n            const key = schemaPath.shift();\r\n            for (let i = 0; i < children.length; ++i) {\r\n                const child = children[i];\r\n                if (child.key === key) {\r\n                    return reach(child.schema, schemaPath);\r\n                }\r\n            }\r\n        };\r\n\r\n        const schemaPath = typeof path === 'string' ? (path ? path.split('.') : []) : path.slice();\r\n\r\n        return reach(schema, schemaPath);\r\n    };\r\n\r\n    root.lazy = function (...args) {\r\n\r\n        return internals.callWithDefaults.call(this, Lazy, args);\r\n    };\r\n\r\n    root.defaults = function (fn) {\r\n\r\n        Hoek.assert(typeof fn === 'function', 'Defaults must be a function');\r\n\r\n        let joi = Object.create(this.any());\r\n        joi = fn(joi);\r\n\r\n        Hoek.assert(joi && joi instanceof this.constructor, 'defaults() must return a schema');\r\n\r\n        Object.assign(joi, this, joi.clone()); // Re-add the types from `this` but also keep the settings from joi's potential new defaults\r\n\r\n        joi._defaults = (schema) => {\r\n\r\n            if (this._defaults) {\r\n                schema = this._defaults(schema);\r\n                Hoek.assert(schema instanceof this.constructor, 'defaults() must return a schema');\r\n            }\r\n\r\n            schema = fn(schema);\r\n            Hoek.assert(schema instanceof this.constructor, 'defaults() must return a schema');\r\n            return schema;\r\n        };\r\n\r\n        return joi;\r\n    };\r\n\r\n    root.bind = function () {\r\n\r\n        const joi = Object.create(this);\r\n\r\n        joi._binds.forEach((bind) => {\r\n\r\n            joi[bind] = joi[bind].bind(joi);\r\n        });\r\n\r\n        return joi;\r\n    };\r\n\r\n    root.extend = function (...args) {\r\n\r\n        const extensions = Hoek.flatten(args);\r\n        Hoek.assert(extensions.length > 0, 'You need to provide at least one extension');\r\n\r\n        this.assert(extensions, root.extensionsSchema);\r\n\r\n        const joi = Object.create(this.any());\r\n        Object.assign(joi, this);\r\n        joi._currentJoi = joi;\r\n        joi._binds = new Set(joi._binds);\r\n\r\n        for (let i = 0; i < extensions.length; ++i) {\r\n            let extension = extensions[i];\r\n\r\n            if (typeof extension === 'function') {\r\n                extension = extension(joi);\r\n            }\r\n\r\n            this.assert(extension, root.extensionSchema);\r\n\r\n            const base = (extension.base || this.any()).clone(); // Cloning because we're going to override language afterwards\r\n            const ctor = base.constructor;\r\n            const type = class extends ctor { // eslint-disable-line no-loop-func\r\n\r\n                constructor() {\r\n\r\n                    super();\r\n                    if (extension.base) {\r\n                        Object.assign(this, base);\r\n                    }\r\n\r\n                    this._type = extension.name;\r\n\r\n                    if (extension.language) {\r\n                        this._settings = Settings.concat(this._settings, {\r\n                            language: {\r\n                                [extension.name]: extension.language\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n\r\n            };\r\n\r\n            if (extension.coerce) {\r\n                type.prototype._coerce = function (value, state, options) {\r\n\r\n                    if (ctor.prototype._coerce) {\r\n                        const baseRet = ctor.prototype._coerce.call(this, value, state, options);\r\n\r\n                        if (baseRet.errors) {\r\n                            return baseRet;\r\n                        }\r\n\r\n                        value = baseRet.value;\r\n                    }\r\n\r\n                    const ret = extension.coerce.call(this, value, state, options);\r\n                    if (ret instanceof Errors.Err) {\r\n                        return { value, errors: ret };\r\n                    }\r\n\r\n                    return { value: ret };\r\n                };\r\n            }\r\n\r\n            if (extension.pre) {\r\n                type.prototype._base = function (value, state, options) {\r\n\r\n                    if (ctor.prototype._base) {\r\n                        const baseRet = ctor.prototype._base.call(this, value, state, options);\r\n\r\n                        if (baseRet.errors) {\r\n                            return baseRet;\r\n                        }\r\n\r\n                        value = baseRet.value;\r\n                    }\r\n\r\n                    const ret = extension.pre.call(this, value, state, options);\r\n                    if (ret instanceof Errors.Err) {\r\n                        return { value, errors: ret };\r\n                    }\r\n\r\n                    return { value: ret };\r\n                };\r\n            }\r\n\r\n            if (extension.rules) {\r\n                for (let j = 0; j < extension.rules.length; ++j) {\r\n                    const rule = extension.rules[j];\r\n                    const ruleArgs = rule.params ?\r\n                        (rule.params instanceof Any ? rule.params._inner.children.map((k) => k.key) : Object.keys(rule.params)) :\r\n                        [];\r\n                    const validateArgs = rule.params ? Cast.schema(this, rule.params) : null;\r\n\r\n                    type.prototype[rule.name] = function (...rArgs) { // eslint-disable-line no-loop-func\r\n\r\n                        if (rArgs.length > ruleArgs.length) {\r\n                            throw new Error('Unexpected number of arguments');\r\n                        }\r\n\r\n                        let hasRef = false;\r\n                        let arg = {};\r\n\r\n                        for (let k = 0; k < ruleArgs.length; ++k) {\r\n                            arg[ruleArgs[k]] = rArgs[k];\r\n                            if (!hasRef && Ref.isRef(rArgs[k])) {\r\n                                hasRef = true;\r\n                            }\r\n                        }\r\n\r\n                        if (validateArgs) {\r\n                            arg = joi.attempt(arg, validateArgs);\r\n                        }\r\n\r\n                        let schema;\r\n                        if (rule.validate) {\r\n                            const validate = function (value, state, options) {\r\n\r\n                                return rule.validate.call(this, arg, value, state, options);\r\n                            };\r\n\r\n                            schema = this._test(rule.name, arg, validate, {\r\n                                description: rule.description,\r\n                                hasRef\r\n                            });\r\n                        }\r\n                        else {\r\n                            schema = this.clone();\r\n                        }\r\n\r\n                        if (rule.setup) {\r\n                            const newSchema = rule.setup.call(schema, arg);\r\n                            if (newSchema !== undefined) {\r\n                                Hoek.assert(newSchema instanceof Any, `Setup of extension Joi.${this._type}().${rule.name}() must return undefined or a Joi object`);\r\n                                schema = newSchema;\r\n                            }\r\n                        }\r\n\r\n                        return schema;\r\n                    };\r\n                }\r\n            }\r\n\r\n            if (extension.describe) {\r\n                type.prototype.describe = function () {\r\n\r\n                    const description = ctor.prototype.describe.call(this);\r\n                    return extension.describe.call(this, description);\r\n                };\r\n            }\r\n\r\n            const instance = new type();\r\n            joi[extension.name] = function (...extArgs) {\r\n\r\n                return internals.callWithDefaults.call(this, instance, extArgs);\r\n            };\r\n\r\n            joi._binds.add(extension.name);\r\n        }\r\n\r\n        return joi;\r\n    };\r\n\r\n    root.extensionSchema = internals.object.keys({\r\n        base: internals.object.type(Any, 'Joi object'),\r\n        name: internals.string.required(),\r\n        coerce: internals.func.arity(3),\r\n        pre: internals.func.arity(3),\r\n        language: internals.object,\r\n        describe: internals.func.arity(1),\r\n        rules: internals.array.items(internals.object.keys({\r\n            name: internals.string.required(),\r\n            setup: internals.func.arity(1),\r\n            validate: internals.func.arity(4),\r\n            params: [\r\n                internals.object.pattern(/.*/, internals.object.type(Any, 'Joi object')),\r\n                internals.object.type(internals.object.constructor, 'Joi object')\r\n            ],\r\n            description: [internals.string, internals.func.arity(1)]\r\n        }).or('setup', 'validate'))\r\n    }).strict();\r\n\r\n    root.extensionsSchema = internals.array.items([internals.object, internals.func.arity(1)]).strict();\r\n\r\n    root.version = require('../package.json').version;\r\n\r\n    return root;\r\n};\r\n\r\n\r\nmodule.exports = internals.root();\r\n"]},"metadata":{},"sourceType":"script"}